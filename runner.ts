import { env, nanoseconds, spawn } from "bun";

if (!env.BF_RUNTIME) {
    console.error("BF_RUNTIME環境変数を指定してね");
    process.exit(1);
}

const start = nanoseconds();
const proc = spawn({
    cmd: [env.BF_RUNTIME!, "64bitmul.bf"],
    stdin: "pipe",
    stdout: "pipe",
});

const brainrot = [
    1, 0xD9, 0x4F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    1, 0x27, 0x43, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    1, 0x2F, 0x3E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    1, 0x8F, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    1, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    1, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    1, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0,
];

const two_pow = [
    ...Array(64).fill([1, ...crypto.getRandomValues(new Uint8Array(8))]).flat(),
    0,
];

await proc.stdin.write(new Uint8Array(two_pow));
await proc.exited;
const end = nanoseconds();
console.log(`\nCalculated in ${end - start}ns`);
console.log(await proc.stdout.bytes());
